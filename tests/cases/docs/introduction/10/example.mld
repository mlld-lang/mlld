exe @haiku(prompt) = @prompt | cmd { claude -p --model haiku --tools "" }

exe @reviewFile(file) = [
  let @prompt = `Review this code for issues:\nFile: @file.mx.relative\n---\n@file\n---\nList 2-3 issues or "LGTM". Be concise.`
  let @review = @haiku(@prompt)
  => { file: @file.mx.relative, review: @review.trim() }
]

var @reviews = for parallel(5) @f in <src/**/*.ts> => @reviewFile(@f)

for @r in @reviews [
  show `## @r.file`
  show @r.review
]