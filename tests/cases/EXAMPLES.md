# Mlld Examples

This file contains all test case examples organized by category.
Generated by `tests/utils/ast-fixtures.js`

## Table of Contents

- [Exceptions](#exceptions)
  - [Import non module](#exceptions-import-non-module)
  - [Path module content](#exceptions-path-module-content)
  - [Text parameterized run command](#exceptions-text-parameterized-run-command)
  - [When any with individual actions](#exceptions-when-any-with-individual-actions)
  - [When literal condition](#exceptions-when-literal-condition)
- [Valid](#valid)
  - [Examples](#valid-examples)
  - [Exec invocation module](#valid-exec-invocation-module)
  - [Exec parameterized command](#valid-exec-parameterized-command)
  - [Resolver contexts](#valid-resolver-contexts)
- [Warnings](#warnings)
  - [Bare variable reference](#warnings-bare-variable-reference)
  - [Directive in text line](#warnings-directive-in-text-line)
  - [Template syntax in text](#warnings-template-syntax-in-text)

## Exceptions

### Exceptions Import non module

**Input:**
```mlld
# Test Import Non-Module Rejection

/import { content } from "./data.txt"
/add @content
```

### Exceptions Path module content

**Input:**
```mlld
# Test Path Module Rejection

/path @mod = "./module.mld"
/add @mod
```

### Exceptions Text parameterized run command

**Input:**
```mlld
# Parameterized Text with Run Command (Invalid)

This example shows an invalid syntax where someone tries to create a parameterized text variable with a `@run` command.

/exec @codecat(dir) = @run {find @dir -type f -exec sh -c 'echo "<$(realpath --relative-to=@dir {})>"; cat {}; echo "@dir {})>"' \;}

This should fail because:
1. Parameterized text templates should use `@exec` not `@text`
2. The complex shell escaping may not be properly handled
3. There's malformed syntax at the end
```

### Exceptions When any with individual actions

**Input:**
```mlld
/text @condition1 = "true"
/text @condition2 = "false"

# Invalid: any: modifier cannot have individual actions
/when @condition1 any: [
  @condition1 => @add "Action 1"
  @condition2 => @add "Action 2"
]
```

### Exceptions When literal condition

**Input:**
```mlld
# When Directive with Literal Condition

The @when directive requires a variable to evaluate, not a literal value.

## Invalid: Using literal true
/when true => @add "This is invalid syntax"

## Invalid: Using literal false  
/when false => @add "This is also invalid"

## Invalid: Using literal null
/when null => @add "This too is invalid"

## Invalid: Using literal string
/when "value" => @add "String literals are not allowed"

## Valid: Using a variable
/text @myCondition = "true"
/when @myCondition => @add "This is valid syntax"
```

## Valid

### Valid Examples

**Input:**
```mlld
// This is a comment and should be ignored
// I can write a couple lines of them if I want and no one will ever know.

/import { * } from "files/imports.mld"

/data @role = {
    "architect": "You are a senior architect skilled in assessing TypeScript codebases.",
    "ux": "You are a senior ux designer skilled in assessing user experience.",
    "security": "You are a senior security engineer skilled in assessing TypeScript codebases."
}

/data @task = {
    "code_review": "Carefully review the code and test results and advise on the quality of the code and areas of improvement.",
    "ux_review": "Carefully review the user experience and advise on the quality of the user experience and areas of improvement.",
    "security_review": "Carefully review the security of the code and advise on the quality of the security and areas of improvement."
}

## Your role
/add @role.architect

## Documentation
### Architecture
/add @path "./docs/dev/ARCHITECTURE.md" # TESTING INFRASTRUCTURE
### Mlld error handling
/add @path "./docs/dev/ERRORS.md"

## Test Results
/run npm test core/syntax

## Your task
/add @task.code_review

// this doesn't work but should
// @run @text codecat("./examples")
```

### Valid Exec invocation module

**Input:**
```mlld
# Test exec invocation from module imports

/import { sayHello, greetUser, multiLine, withParams, greeting } from "./test-module.mld"

## Direct invocation
/run @sayHello()

## With parameter
/run @greetUser("Alice")

## Multi-line command
/run @multiLine()

## Multiple parameters
/run @withParams("foo", "bar")

## In data directive
/data @result = @sayHello()
/add @result

## In text template
/text @message = [[Output: {{greeting}}]]
/add @message

## Verify regular variable import works
/add @greeting
```

**Expected Output:**
```markdown
# Test exec invocation from module imports

## Direct invocation
Hello, World!

## With parameter
Hello, Alice!

## Multi-line command
Line 1
Line 2

## Multiple parameters
First: foo, Second: bar

## In data directive

Hello, World!
## In text template

Output: Hello from module
## Verify regular variable import works
Hello from module
```

### Valid Exec parameterized command

**Input:**
```mlld
# Parameterized Exec Command (Valid)

This example shows the correct way to create a parameterized command using `@exec`.

/exec @greet(name) = {echo "Hello @name!"
echo "Welcome @name!"
echo "Greetings @name!"}

/run @greet("Alice")
```

**Expected Output:**
```markdown
# Parameterized Exec Command (Valid)

This example shows the correct way to create a parameterized command using `@exec`.

Hello Alice!
Welcome Alice!
Greetings Alice!
```

### Valid Resolver contexts

**Input:**
```mlld
# Test Resolver Context-Dependent Behavior

## TIME as variable (returns text)
/text @timestamp = @TIME
/add [[Variable TIME: {{timestamp}}]]

## TIME as import (returns data with multiple formats)
/import { iso, unix, date } from @TIME
/add [[Import TIME - ISO: {{iso}}, Date: {{date}}]]
```

**Expected Output:**
```markdown
# Test Resolver Context-Dependent Behavior

## TIME as variable (returns text)

Variable TIME: 2024-01-01T00:00:00.000Z
## TIME as import (returns data with multiple formats)
Import TIME - ISO: 2024-01-01T00:00:00.000Z, Date: 2024-01-01
```

## Warnings

### Warnings Bare variable reference

**Input:**
```mlld
/text @myvar = "Hello world"

This line contains a bare variable reference: @myvar
```

### Warnings Directive in text line

**Input:**
```mlld
/text @myvar = "Hello world"

Some text @add @myvar in the middle of a line.
```

### Warnings Template syntax in text

**Input:**
```mlld
/text @myvar = "Hello world"

This line uses template syntax: {{myvar}}
```
