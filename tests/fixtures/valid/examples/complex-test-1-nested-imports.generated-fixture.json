{
  "name": "complex-test-1-nested-imports",
  "description": "Test fixture for valid/examples",
  "category": "valid",
  "subcategory": "examples",
  "input": "# Complex Test 1: Nested Imports and Variable Scoping\n\n@text project_name = \"Meld Complex Test\"\n\n# Create a library file that imports another file\n@text lib_content = [[\n@import { imported_title } from \"files/imports.mld\"\n@text lib_message = \"Library says: {{imported_title}}\"\n@data lib_config = {\n  \"name\": \"lib\",\n  \"version\": \"1.0.0\",\n  \"imported\": @imported_title\n}\n]]\n\n>> Simulate creating the lib file (in real usage, this would be a separate file)\n@exec write_lib(content) = @run [echo '@lib_content @content' > ./files/lib.mld]\n\n@run @write_lib(\"Hi\")\n\n>> Now import from our \"lib\" that itself has imports\n@import { lib_message, lib_config } from \"./files/lib.mld\"\n\n>> Test if nested imports work and variable scoping is correct\n@text final_output = [[\nProject: {{project_name}}\nLibrary Message: {{lib_message}}\nLibrary Config: {{lib_config.name}} v{{lib_config.version}}\nImported Value in Config: {{lib_config.imported}}\n]]\n\n@add @final_output",
  "expected": null,
  "expectedError": null,
  "expectedWarning": null,
  "actualOutput": null,
  "ast": [
    {
      "type": "Text",
      "nodeId": "e3832e72-84eb-4ae2-b240-dae571dd19e1",
      "location": {
        "start": {
          "offset": 0,
          "line": 1,
          "column": 1
        },
        "end": {
          "offset": 55,
          "line": 3,
          "column": 1
        }
      },
      "content": "# Complex Test 1: Nested Imports and Variable Scoping\n\n"
    },
    {
      "type": "Directive",
      "nodeId": "f55e34c0-8c11-4d42-a977-69c54bc3531c",
      "location": {
        "start": {
          "offset": 55,
          "line": 3,
          "column": 1
        },
        "end": {
          "offset": 95,
          "line": 3,
          "column": 41
        }
      },
      "kind": "text",
      "subtype": "textAssignment",
      "source": "literal",
      "values": {
        "identifier": [
          {
            "type": "VariableReference",
            "nodeId": "9f4ef4b2-d8ae-4c88-a689-93a4ccace702",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "identifier",
            "identifier": "project_name"
          }
        ],
        "content": [
          {
            "type": "Text",
            "nodeId": "c830e2a6-2485-4560-9ade-82d55a731bdf",
            "location": {
              "start": {
                "offset": 76,
                "line": 3,
                "column": 22
              },
              "end": {
                "offset": 95,
                "line": 3,
                "column": 41
              }
            },
            "content": "Meld Complex Test"
          }
        ]
      },
      "raw": {
        "identifier": "project_name",
        "content": "Meld Complex Test"
      },
      "meta": {
        "sourceType": "literal",
        "hasVariables": false,
        "isTemplateContent": false
      }
    },
    {
      "type": "Text",
      "nodeId": "9be19056-53cf-4630-8148-7f9ef5fdaed0",
      "location": {
        "start": {
          "offset": 95,
          "line": 3,
          "column": 41
        },
        "end": {
          "offset": 147,
          "line": 6,
          "column": 1
        }
      },
      "content": "\n\n# Create a library file that imports another file\n"
    },
    {
      "type": "Directive",
      "nodeId": "975b4889-518d-4711-b7e8-af8562808ac9",
      "location": {
        "start": {
          "offset": 147,
          "line": 6,
          "column": 1
        },
        "end": {
          "offset": 371,
          "line": 14,
          "column": 3
        }
      },
      "kind": "text",
      "subtype": "textTemplate",
      "source": "template",
      "values": {
        "identifier": [
          {
            "type": "VariableReference",
            "nodeId": "ff576357-36cf-46c5-873b-b1d6b9771269",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "identifier",
            "identifier": "lib_content"
          }
        ],
        "content": [
          {
            "type": "Text",
            "nodeId": "66e00dc8-665c-48e9-87ae-6254241e3e1d",
            "location": {
              "start": {
                "offset": 169,
                "line": 6,
                "column": 23
              },
              "end": {
                "offset": 257,
                "line": 8,
                "column": 36
              }
            },
            "content": "\n@import { imported_title } from \"files/imports.mld\"\n@text lib_message = \"Library says: "
          },
          {
            "type": "VariableReference",
            "nodeId": "bbc57f37-95ea-48f5-ace4-0af2c51feafa",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "imported_title"
          },
          {
            "type": "Text",
            "nodeId": "290f3e21-3070-4933-a062-c2cb9a61f57f",
            "location": {
              "start": {
                "offset": 275,
                "line": 8,
                "column": 54
              },
              "end": {
                "offset": 369,
                "line": 14,
                "column": 1
              }
            },
            "content": "\"\n@data lib_config = {\n  \"name\": \"lib\",\n  \"version\": \"1.0.0\",\n  \"imported\": @imported_title\n}\n"
          }
        ]
      },
      "raw": {
        "identifier": "lib_content",
        "content": "\n@import { imported_title } from \"files/imports.mld\"\n@text lib_message = \"Library says: {{imported_title}}\"\n@data lib_config = {\n  \"name\": \"lib\",\n  \"version\": \"1.0.0\",\n  \"imported\": @imported_title\n}\n"
      },
      "meta": {
        "sourceType": "template",
        "hasVariables": true,
        "isTemplateContent": true
      }
    },
    {
      "type": "Text",
      "nodeId": "9c940222-ff29-4c14-896d-aa0afec4e88c",
      "location": {
        "start": {
          "offset": 371,
          "line": 14,
          "column": 3
        },
        "end": {
          "offset": 373,
          "line": 16,
          "column": 1
        }
      },
      "content": "\n\n"
    },
    {
      "type": "Comment",
      "nodeId": "6b55fc25-5764-4c88-82de-165a82279f53",
      "location": {
        "start": {
          "offset": 373,
          "line": 16,
          "column": 1
        },
        "end": {
          "offset": 454,
          "line": 17,
          "column": 1
        }
      },
      "content": "Simulate creating the lib file (in real usage, this would be a separate file)"
    },
    {
      "type": "Directive",
      "nodeId": "5fcfbec3-f8d2-45d9-be86-831c8cd7bc54",
      "location": {
        "start": {
          "offset": 454,
          "line": 17,
          "column": 1
        },
        "end": {
          "offset": 534,
          "line": 17,
          "column": 81
        }
      },
      "kind": "exec",
      "subtype": "execCommand",
      "source": "command",
      "values": {
        "identifier": [
          {
            "type": "Text",
            "nodeId": "8d059d17-aab1-48c6-a638-54cc7c0920a4",
            "location": {
              "start": {
                "offset": 454,
                "line": 17,
                "column": 1
              },
              "end": {
                "offset": 534,
                "line": 17,
                "column": 81
              }
            },
            "content": "write_lib"
          }
        ],
        "params": [
          "content"
        ],
        "command": [
          {
            "type": "Text",
            "nodeId": "d84d2127-6146-4fd9-9bdf-9a7bf7e4a20f",
            "location": {
              "start": {
                "offset": 487,
                "line": 17,
                "column": 34
              },
              "end": {
                "offset": 493,
                "line": 17,
                "column": 40
              }
            },
            "content": "echo '"
          },
          {
            "type": "VariableReference",
            "nodeId": "e7fea52f-b7d1-40f5-bbfa-2965707e1171",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varIdentifier",
            "identifier": "lib_content"
          },
          {
            "type": "Text",
            "nodeId": "80960a22-2ff8-4b7a-a8a0-809126a9d76d",
            "location": {
              "start": {
                "offset": 505,
                "line": 17,
                "column": 52
              },
              "end": {
                "offset": 506,
                "line": 17,
                "column": 53
              }
            },
            "content": " "
          },
          {
            "type": "VariableReference",
            "nodeId": "dd673ac8-f49d-462b-b122-a2bb700a45b1",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varIdentifier",
            "identifier": "content"
          },
          {
            "type": "Text",
            "nodeId": "873a898c-dc30-4b6c-849e-c2ed19445bff",
            "location": {
              "start": {
                "offset": 514,
                "line": 17,
                "column": 61
              },
              "end": {
                "offset": 519,
                "line": 17,
                "column": 66
              }
            },
            "content": "' > ."
          },
          {
            "type": "PathSeparator",
            "nodeId": "f80be615-711f-4dc7-8783-834cca4edc40",
            "location": {
              "start": {
                "offset": 519,
                "line": 17,
                "column": 66
              },
              "end": {
                "offset": 520,
                "line": 17,
                "column": 67
              }
            },
            "value": "/"
          },
          {
            "type": "Text",
            "nodeId": "8c88d516-ae21-48ac-991e-85fd4a86ac72",
            "location": {
              "start": {
                "offset": 520,
                "line": 17,
                "column": 67
              },
              "end": {
                "offset": 525,
                "line": 17,
                "column": 72
              }
            },
            "content": "files"
          },
          {
            "type": "PathSeparator",
            "nodeId": "f028c524-38eb-4a21-b8f4-dc625b84749c",
            "location": {
              "start": {
                "offset": 525,
                "line": 17,
                "column": 72
              },
              "end": {
                "offset": 526,
                "line": 17,
                "column": 73
              }
            },
            "value": "/"
          },
          {
            "type": "Text",
            "nodeId": "e0d09d4f-8709-4cc5-a87a-724027e5235c",
            "location": {
              "start": {
                "offset": 526,
                "line": 17,
                "column": 73
              },
              "end": {
                "offset": 533,
                "line": 17,
                "column": 80
              }
            },
            "content": "lib.mld"
          }
        ],
        "commandBases": [
          {
            "nodeId": "221fc570-76a0-4c30-bc98-3517e89fad34",
            "location": {
              "start": {
                "offset": 486,
                "line": 17,
                "column": 33
              },
              "end": {
                "offset": 534,
                "line": 17,
                "column": 81
              }
            },
            "command": "echo"
          }
        ]
      },
      "raw": {
        "identifier": "write_lib",
        "params": [
          "content"
        ],
        "command": "echo '@lib_content @content' > ./files/lib.mld",
        "commandBases": [
          "echo"
        ]
      },
      "meta": {
        "hasVariables": true,
        "commandCount": 1,
        "hasScriptRunner": false,
        "parameterCount": 1
      }
    },
    {
      "type": "Text",
      "nodeId": "b0a9783e-f9ec-4bd9-bd6e-9712b37dbbaa",
      "location": {
        "start": {
          "offset": 534,
          "line": 17,
          "column": 81
        },
        "end": {
          "offset": 536,
          "line": 19,
          "column": 1
        }
      },
      "content": "\n\n"
    },
    {
      "type": "Directive",
      "nodeId": "ddcf3ef8-e5db-4402-8d0b-be8451136c23",
      "location": {
        "start": {
          "offset": 536,
          "line": 19,
          "column": 1
        },
        "end": {
          "offset": 557,
          "line": 19,
          "column": 22
        }
      },
      "kind": "run",
      "subtype": "runExec",
      "source": "exec",
      "values": {
        "identifier": [
          {
            "type": "Text",
            "nodeId": "1e69c426-e7c1-47a0-bc46-70065a463248",
            "location": {
              "start": {
                "offset": 542,
                "line": 19,
                "column": 7
              },
              "end": {
                "offset": 557,
                "line": 19,
                "column": 22
              }
            },
            "content": "write_lib"
          }
        ],
        "args": [
          {
            "type": "Text",
            "nodeId": "1ce47bcb-0ac4-4371-8a83-fd350676ed86",
            "location": {
              "start": {
                "offset": 552,
                "line": 19,
                "column": 17
              },
              "end": {
                "offset": 556,
                "line": 19,
                "column": 21
              }
            },
            "content": "Hi"
          }
        ]
      },
      "raw": {
        "identifier": "write_lib",
        "args": [
          "Hi"
        ]
      },
      "meta": {
        "argumentCount": 1
      }
    },
    {
      "type": "Text",
      "nodeId": "3f120be6-d215-4d15-8645-63919e77f02f",
      "location": {
        "start": {
          "offset": 557,
          "line": 19,
          "column": 22
        },
        "end": {
          "offset": 559,
          "line": 21,
          "column": 1
        }
      },
      "content": "\n\n"
    },
    {
      "type": "Comment",
      "nodeId": "6190b381-38a2-4659-98bb-c30ccf7293e2",
      "location": {
        "start": {
          "offset": 559,
          "line": 21,
          "column": 1
        },
        "end": {
          "offset": 612,
          "line": 22,
          "column": 1
        }
      },
      "content": "Now import from our \"lib\" that itself has imports"
    },
    {
      "type": "Directive",
      "nodeId": "ea1e34fc-8d6a-47ba-a738-d38a58a5c776",
      "location": {
        "start": {
          "offset": 612,
          "line": 22,
          "column": 1
        },
        "end": {
          "offset": 670,
          "line": 22,
          "column": 59
        }
      },
      "kind": "import",
      "subtype": "importSelected",
      "source": "path",
      "values": {
        "imports": [
          {
            "type": "VariableReference",
            "nodeId": "7c5df637-5ac9-4013-b70f-9dce73e92b46",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "import",
            "identifier": "lib_message"
          },
          {
            "type": "VariableReference",
            "nodeId": "a13afa07-41c7-4d5b-b92d-bca784a1bd02",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "import",
            "identifier": "lib_config"
          }
        ],
        "path": [
          {
            "type": "Text",
            "nodeId": "b4bb43a9-8ccd-4e4c-b2de-b0cc7227e70b",
            "location": {
              "start": {
                "offset": 653,
                "line": 22,
                "column": 42
              },
              "end": {
                "offset": 670,
                "line": 22,
                "column": 59
              }
            },
            "content": "./files/lib.mld"
          }
        ]
      },
      "raw": {
        "imports": "lib_message, lib_config",
        "path": "./files/lib.mld"
      },
      "meta": {
        "path": {
          "hasVariables": false,
          "isAbsolute": false,
          "hasExtension": true,
          "extension": "mld",
          "pathSubtype": "filePath"
        }
      }
    },
    {
      "type": "Text",
      "nodeId": "ccc9f6da-4c52-4b1e-94ea-421e13d7840a",
      "location": {
        "start": {
          "offset": 670,
          "line": 22,
          "column": 59
        },
        "end": {
          "offset": 672,
          "line": 24,
          "column": 1
        }
      },
      "content": "\n\n"
    },
    {
      "type": "Comment",
      "nodeId": "0e1f6764-7730-43af-a701-0bcba832dcdf",
      "location": {
        "start": {
          "offset": 672,
          "line": 24,
          "column": 1
        },
        "end": {
          "offset": 735,
          "line": 25,
          "column": 1
        }
      },
      "content": "Test if nested imports work and variable scoping is correct"
    },
    {
      "type": "Directive",
      "nodeId": "0ee11f44-adc7-4a9f-b8aa-f5c5a81ae1a9",
      "location": {
        "start": {
          "offset": 735,
          "line": 25,
          "column": 1
        },
        "end": {
          "offset": 930,
          "line": 30,
          "column": 3
        }
      },
      "kind": "text",
      "subtype": "textTemplate",
      "source": "template",
      "values": {
        "identifier": [
          {
            "type": "VariableReference",
            "nodeId": "436a394a-0c5d-40b1-9d57-f7f040485614",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "identifier",
            "identifier": "final_output"
          }
        ],
        "content": [
          {
            "type": "Text",
            "nodeId": "02bbaa8e-c133-496e-9adc-be738ed6d81a",
            "location": {
              "start": {
                "offset": 758,
                "line": 25,
                "column": 24
              },
              "end": {
                "offset": 768,
                "line": 26,
                "column": 10
              }
            },
            "content": "\nProject: "
          },
          {
            "type": "VariableReference",
            "nodeId": "bbddb210-1224-4895-b2b1-6efc8651428c",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "project_name"
          },
          {
            "type": "Text",
            "nodeId": "3b789fcf-2f15-4850-9e8a-ef86a957b1c6",
            "location": {
              "start": {
                "offset": 784,
                "line": 26,
                "column": 26
              },
              "end": {
                "offset": 802,
                "line": 27,
                "column": 18
              }
            },
            "content": "\nLibrary Message: "
          },
          {
            "type": "VariableReference",
            "nodeId": "5a441c7f-1a7b-4c2e-9648-d81eb8559724",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "lib_message"
          },
          {
            "type": "Text",
            "nodeId": "d34368b8-65a4-456a-b5a5-518f6ae317f9",
            "location": {
              "start": {
                "offset": 817,
                "line": 27,
                "column": 33
              },
              "end": {
                "offset": 834,
                "line": 28,
                "column": 17
              }
            },
            "content": "\nLibrary Config: "
          },
          {
            "type": "VariableReference",
            "nodeId": "c0567bec-787f-404d-9575-ed6cc48df816",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "lib_config",
            "fields": [
              {
                "type": "field",
                "name": "name"
              }
            ]
          },
          {
            "type": "Text",
            "nodeId": "34f91a18-e28c-44b1-9ac4-bef57751106d",
            "location": {
              "start": {
                "offset": 853,
                "line": 28,
                "column": 36
              },
              "end": {
                "offset": 855,
                "line": 28,
                "column": 38
              }
            },
            "content": " v"
          },
          {
            "type": "VariableReference",
            "nodeId": "b94bfcf0-b810-472b-8c42-d6ba29fa13b5",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "lib_config",
            "fields": [
              {
                "type": "field",
                "name": "version"
              }
            ]
          },
          {
            "type": "Text",
            "nodeId": "309be4ac-39bf-42c4-8177-985e4e110389",
            "location": {
              "start": {
                "offset": 877,
                "line": 28,
                "column": 60
              },
              "end": {
                "offset": 904,
                "line": 29,
                "column": 27
              }
            },
            "content": "\nImported Value in Config: "
          },
          {
            "type": "VariableReference",
            "nodeId": "59701eb4-da81-4b35-8c5f-37fc36d884f5",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varInterpolation",
            "identifier": "lib_config",
            "fields": [
              {
                "type": "field",
                "name": "imported"
              }
            ]
          },
          {
            "type": "Text",
            "nodeId": "218d60c0-c4e7-43fc-8e05-0b9ef23c0ee7",
            "location": {
              "start": {
                "offset": 927,
                "line": 29,
                "column": 50
              },
              "end": {
                "offset": 928,
                "line": 30,
                "column": 1
              }
            },
            "content": "\n"
          }
        ]
      },
      "raw": {
        "identifier": "final_output",
        "content": "\nProject: {{project_name}}\nLibrary Message: {{lib_message}}\nLibrary Config: {{lib_config}} v{{lib_config}}\nImported Value in Config: {{lib_config}}\n"
      },
      "meta": {
        "sourceType": "template",
        "hasVariables": true,
        "isTemplateContent": true
      }
    },
    {
      "type": "Text",
      "nodeId": "ebc28d6c-861c-4e59-a9e2-8c68bc8d0096",
      "location": {
        "start": {
          "offset": 930,
          "line": 30,
          "column": 3
        },
        "end": {
          "offset": 932,
          "line": 32,
          "column": 1
        }
      },
      "content": "\n\n"
    },
    {
      "type": "Directive",
      "nodeId": "723d631c-48ae-4d55-9665-562499979c17",
      "location": {
        "start": {
          "offset": 932,
          "line": 32,
          "column": 1
        },
        "end": {
          "offset": 950,
          "line": 32,
          "column": 19
        }
      },
      "kind": "add",
      "subtype": "addVariable",
      "source": "variable",
      "values": {
        "variable": [
          {
            "type": "VariableReference",
            "nodeId": "1ec4619d-a079-4908-afe7-8318657d24bc",
            "location": {
              "start": {
                "offset": 0,
                "line": 1,
                "column": 1
              },
              "end": {
                "offset": 0,
                "line": 1,
                "column": 1
              }
            },
            "valueType": "varIdentifier",
            "identifier": "final_output"
          }
        ]
      },
      "raw": {
        "variable": "@final_output"
      },
      "meta": {}
    }
  ],
  "parseError": null
}