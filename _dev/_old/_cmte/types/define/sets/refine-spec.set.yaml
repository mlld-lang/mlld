name: refine-spec
description: "Refine the final type specification for the '@{{ directiveName }}' directive based on collected feedback."
# No for_each, this is a single architect task

tasks:
  - useTask: refine-final-directive-spec
    prior_outputs:
      # Map the original draft spec from Set 3 (non-iterated)
      draft_spec: "{{ draft-spec.draft-initial-directive-spec.output }}"
      # Map the collected feedback using [*] to aggregate all outputs from the iterated set
      service_feedback: "{{ collect-draft-feedback.review-specific-directive-draft[*].output }}"
    # Task context will include:
    # - draft_spec (the initial draft TypeScript code)
    # - service_feedback (the collected feedback from all services)
    # - global_variables (overallArchitecture, directiveName, directiveClarityContent) 