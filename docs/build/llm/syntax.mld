>> Build llms-syntax.txt from atoms
>> This should produce output matching the original docs/llm/llms-syntax.txt

>> Strip frontmatter helper
exe @strip(content) = js {
  return content.replace(/^---[\s\S]*?---\n*/, '').trim();
}

>> Variable atoms
var @varAtoms = [
  <@base/docs/src/atoms/syntax/variables-basics.md>,
  <@base/docs/src/atoms/syntax/variables-conditional.md>,
  <@base/docs/src/atoms/syntax/variables-truthiness.md>
]

>> Template atoms
var @templateAtoms = [
  <@base/docs/src/atoms/syntax/templates-basics.md>,
  <@base/docs/src/atoms/syntax/templates-external.md>,
  <@base/docs/src/atoms/syntax/templates-loops.md>
]

>> File loading atoms
var @fileAtoms = [
  <@base/docs/src/atoms/syntax/file-loading-basics.md>,
  <@base/docs/src/atoms/syntax/file-loading-ast.md>,
  <@base/docs/src/atoms/syntax/file-loading-metadata.md>,
  <@base/docs/src/atoms/syntax/file-loading-json-accessors.md>
]

>> Pipeline atoms
var @pipelineAtoms = [
  <@base/docs/src/atoms/syntax/pipelines-basics.md>,
  <@base/docs/src/atoms/syntax/pipelines-context.md>,
  <@base/docs/src/atoms/syntax/pipelines-retry.md>,
  <@base/docs/src/atoms/syntax/pipelines-parallel.md>
]

>> Standalone atoms
var @methods = <@base/docs/src/atoms/syntax/methods-builtin.md>
var @comments = <@base/docs/src/atoms/syntax/comments.md>
var @reservedVars = <@base/docs/src/atoms/syntax/reserved-variables.md>
var @builtins = <@base/docs/src/atoms/syntax/builtins.md>

>> Strip each atom group
var @varStripped = for @a in @varAtoms => @strip(@a)
var @templateStripped = for @a in @templateAtoms => @strip(@a)
var @fileStripped = for @a in @fileAtoms => @strip(@a)
var @pipelineStripped = for @a in @pipelineAtoms => @strip(@a)

>> Build sections with JS for clean concatenation
exe @buildSection(tag, intro, items) = js {
  const body = intro + "\n\n" + items.join("\n\n");
  return `<${tag}>\n${body}\n</${tag}>`;
}

exe @wrapSection(tag, content) = js {
  return `<${tag}>\n${content}\n</${tag}>`;
}

var @varSection = @buildSection("VARIABLES", "Create primitives, arrays, objects, or assign from command/code results.", @varStripped)
var @templateSection = @buildSection("TEMPLATES", "Prefer backticks; use `::` for backticks-in-text.", @templateStripped)
var @fileSection = @buildSection("FILE_LOADING", "Angle brackets load file contents. Supports field access, globs, and AST selection.", @fileStripped)
exe @buildMethodSection(content) = js {
  const stripped = content.replace(/^---[\s\S]*?---\n*/, '').trim();
  return `<BUILTIN_METHODS>\nArrays and strings have builtin methods.\n\n${stripped}\n</BUILTIN_METHODS>`;
}
var @methodSection = @buildMethodSection(@methods)
exe @buildPipelineSection(items) = js {
  const intro = "Chain stages with `|`. Built-ins: `@parse`, `@json` (deprecated alias), `@xml`, `@csv`, `@md`.";
  const body = intro + "\n\n" + items.join("\n\n");
  return `<PIPELINES>\n${body}\n</PIPELINES>`;
}
var @pipelineSection = @buildPipelineSection(@pipelineStripped)
var @commentsSection = @wrapSection("COMMENTS", @strip(@comments))
var @reservedSection = @wrapSection("RESERVED_VARIABLES", @strip(@reservedVars))
var @builtinsSection = @wrapSection("BUILTINS", @strip(@builtins))

var @allSections = [
  @varSection,
  @templateSection,
  @fileSection,
  @methodSection,
  @pipelineSection,
  @commentsSection,
  @reservedSection,
  @builtinsSection
]

var @body = @allSections.join("\n\n")

show `<MLLD_SYNTAX>

@body

</MLLD_SYNTAX>
`
