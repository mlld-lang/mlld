>> Build llms-security.txt from atoms
>> This should produce output matching the original docs/llm/llms-security.txt

>> Strip frontmatter helper
exe @strip(content) = js {
  return content.replace(/^---[\s\S]*?---\n*/, '').trim();
}

>> Security atoms (in original order)
var @guards = <@base/docs/src/atoms/security/guards-basics.md>
var @policies = <@base/docs/src/atoms/security/policies.md>
var @beforeGuards = <@base/docs/src/atoms/security/before-guards.md>
var @afterGuards = <@base/docs/src/atoms/security/after-guards.md>
var @transform = <@base/docs/src/atoms/security/transform-with-allow.md>
var @denied = <@base/docs/src/atoms/security/denied-handlers.md>
var @autoLabels = <@base/docs/src/atoms/security/automatic-labels.md>
var @labelTracking = <@base/docs/src/atoms/security/label-tracking.md>
var @labelModification = <@base/docs/src/atoms/security/label-modification.md>
var @toolCallTracking = <@base/docs/src/atoms/security/tool-call-tracking.md>
var @guardComp = <@base/docs/src/atoms/security/guard-composition.md>
var @needs = <@base/docs/src/atoms/security/needs-declaration.md>

>> Build sections
exe @wrapSection(tag, intro, content) = js {
  return `<${tag}>\n${intro}\n\n${content}\n</${tag}>`;
}

exe @wrapSectionNoIntro(tag, content) = js {
  return `<${tag}>\n${content}\n</${tag}>`;
}

var @guardsSection = @wrapSection("GUARDS", "Guards protect data and operations. Label sensitive data, define policies.", @strip(@guards))
var @policiesSection = @wrapSection("POLICIES", "Define and import policy objects.", @strip(@policies))
var @beforeSection = @wrapSection("BEFORE_GUARDS", "Validate or transform input before operations.", @strip(@beforeGuards))
var @afterSection = @wrapSection("AFTER_GUARDS", "Validate output after operations.", @strip(@afterGuards))
var @transformSection = @wrapSection("TRANSFORM_WITH_ALLOW", "Transform data during guard evaluation.", @strip(@transform))
var @deniedSection = @wrapSection("DENIED_HANDLERS", "Handle denied operations gracefully.", @strip(@denied))
var @autoLabelsSection = @wrapSection("AUTOMATIC_LABELS", "System-assigned labels for tracking:", @strip(@autoLabels))
var @labelTrackingSection = @wrapSection("LABEL_TRACKING", "Labels flow through operations:", @strip(@labelTracking))
var @labelModSection = @wrapSection("LABEL_MODIFICATION", "Modify security labels on return values:", @strip(@labelModification))
var @toolCallSection = @wrapSection("TOOL_CALL_TRACKING", "Track tool usage with @mx.tools:", @strip(@toolCallTracking))
var @guardCompSection = @wrapSection("GUARD_COMPOSITION", "Multiple guards can apply. Resolution order:", @strip(@guardComp))
var @needsSection = @wrapSection("NEEDS_DECLARATION", "Declare required capabilities in modules.", @strip(@needs))

var @allSections = [
  @guardsSection,
  @policiesSection,
  @beforeSection,
  @afterSection,
  @transformSection,
  @deniedSection,
  @autoLabelsSection,
  @labelTrackingSection,
  @labelModSection,
  @toolCallSection,
  @guardCompSection,
  @needsSection
]

var @body = @allSections.join("\n\n")

show `<MLLD_SECURITY>

@body

</MLLD_SECURITY>
`
