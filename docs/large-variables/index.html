<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Working with Large Variables - mlld</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tektur:wght@800&family=Cousine:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/prism-theme.css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/theme.js" defer></script>
  <script src="/js/terminal.js" defer></script>
  <script src="/js/animation.js" defer></script>
  <script src="/js/copy-code.js" defer></script>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo-container">
        <a href="/" class="logo">mlld</a>
        <span class="logo-tagline">pre-release</span>
      </div>
      <nav>
        <ul>
          <li><a href="/docs/" aria-current=&quot;page&quot;>⚠️ Docs</a></li>
          <li><a href="https://discord.gg/mlld">Discord</a></li>
          <li><a href="https://github.com/mlld-lang/mlld">GitHub</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      
<div class="docs-layout">
  <button class="docs-sidebar-toggle" aria-label="Toggle menu" aria-expanded="false">
    <span class="hamburger-icon">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </span>
    <span class="toggle-text">Menu</span>
  </button>
  
  <!-- Add overlay for mobile --> 
  <div class="docs-overlay" id="docs-overlay"></div>
  
  <aside class="docs-sidebar" id="docs-sidebar">
    <nav>
      <h3>Documentation</h3>
      <ul class="nav-list">
        <li><a href="/docs/introduction/" >Introduction</a></li>
        
          
        
          
            <li><a href="/docs/cli/" >CLI Usage </a></li>
          
        
          
            <li><a href="/docs/content-and-data/" >Content and Data</a></li>
          
        
          
            <li><a href="/docs/flow-control/" >Control Flow</a></li>
          
        
          
            <li><a href="/docs/mcp/" >MCP Server Support</a></li>
          
        
          
        
          
            <li><a href="/docs/modules/" >mlld Modules</a></li>
          
        
          
            <li><a href="/docs/registry/" >mlld Registry</a></li>
          
        
          
            <li><a href="/docs/resolvers/" >mlld Resolvers</a></li>
          
        
          
            <li><a href="/docs/quickstart/" >Quick Start</a></li>
          
        
          
            <li><a href="/docs/sdk/" >SDK Usage</a></li>
          
        
          
            <li><a href="/docs/security/" >Security</a></li>
          
        
          
            <li><a href="/docs/reference/" >Syntax Reference</a></li>
          
        
          
            <li><a href="/docs/testing/" >Testing modules</a></li>
          
        
          
            <li><a href="/docs/large-variables/" aria-current=&quot;page&quot;>Working with Large Variables</a></li>
          
        
      </ul>
    </nav>
  </aside>
  
  <div class="docs-content">
    <h1>⚠️ mlld is pre-release</h1>
    <p><a href="https://discord.gg/mlld">Join the discord</a> if you have questions. <a href="https://github.com/mlld/mlld/issues">Report bugs on GitHub</a>.</p>
    <h1 id="working-with-large-variables" tabindex="-1">Working with Large Variables</h1>
<p>mlld can handle large amounts of data like entire codebases. Node.js has limits when passing large variables to commands (typically around ~128KB–200KB for args+env). mlld now automatically falls back to a safe shell mode for large payloads to avoid these limits.</p>
<h2 id="tldr" tabindex="-1">tldr</h2>
<p>Use shell mode for large data (mlld will auto-fallback when needed):</p>
<pre class="language-mlld"><code class="language-mlld"><span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> This usually works automatically now<span class="token punctuation">,</span> but explicit shell mode is recommended <span class="token directive keyword">for</span> clarity <span class="token directive keyword">when</span> dealing <span class="token operator">with</span> large data
/<span class="token directive keyword">run</span> sh <span class="token punctuation">(</span><span class="token variable variable">@largefile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> echo <span class="token string-interpolated"><span class="token punctuation">"</span>$largefile<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> grep <span class="token string-interpolated"><span class="token punctuation">"</span>TODO<span class="token punctuation">"</span></span> <span class="token punctuation">}</span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> This works <span class="token operator">with</span> any size  
/<span class="token directive keyword">run</span> sh <span class="token punctuation">(</span><span class="token variable variable">@largefile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> echo <span class="token string-interpolated"><span class="token punctuation">"</span>$largefile<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> grep <span class="token string-interpolated"><span class="token punctuation">"</span>TODO<span class="token punctuation">"</span></span> <span class="token punctuation">}</span>
</code></pre>
<h2 id="the-problem" tabindex="-1">The Problem</h2>
<p>Node.js can't pass variables larger than ~128KB to commands - it throws an <code>E2BIG</code> error. This happens when loading many files:</p>
<pre class="language-mlld"><code class="language-mlld"><span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Load entire codebase <span class="token punctuation">(</span>could be megabytes<span class="token punctuation">)</span>
/<span class="token directive keyword">var</span> <span class="token variable variable">@allCode</span> <span class="token assignment-operator operator">=</span> <span class="token comparison-operator operator">&lt;</span>**/*<span class="token field-access property">.js</span><span class="token comparison-operator operator">></span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Previously<span class="token punctuation">,</span> this could error if <span class="token variable variable">@allCode</span> <span class="token comparison-operator operator">></span> 128KB. mlld now auto-falls back <span class="token operator">to</span> shell <span class="token directive keyword">when</span> needed.
/<span class="token directive keyword">run</span> sh <span class="token punctuation">(</span><span class="token variable variable">@allCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> echo <span class="token string-interpolated"><span class="token punctuation">"</span>$allCode<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> wc -l <span class="token punctuation">}</span>
</code></pre>
<h2 id="the-solution" tabindex="-1">The Solution</h2>
<h3 id="use-shell-mode" tabindex="-1">Use Shell Mode</h3>
<p>Switch from simple <code>/run {...}</code> to shell mode <code>/run sh {...}</code> when writing workflows, even though mlld auto-fallbacks, because:</p>
<ul>
<li>It’s explicit about using <code>$var</code> syntax inside the block</li>
<li>It avoids implicit fallback and makes intent clear in reviews</li>
</ul>
<pre class="language-mlld"><code class="language-mlld"><span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Simple <span class="token directive keyword">run</span> - limited <span class="token operator">to</span> ~128KB<span class="token punctuation">,</span> uses @<span class="token directive keyword">var</span> syntax
/<span class="token directive keyword">run</span> <span class="token punctuation">{</span>tool <span class="token string-interpolated"><span class="token punctuation">"</span><span class="token variable">@data</span><span class="token punctuation">"</span></span><span class="token punctuation">}</span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Shell mode - handles any size<span class="token punctuation">,</span> pass params then use $<span class="token directive keyword">var</span> syntax
/<span class="token directive keyword">run</span> sh <span class="token punctuation">(</span><span class="token variable variable">@data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> echo <span class="token string-interpolated"><span class="token punctuation">"</span>$data<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> tool <span class="token punctuation">}</span>
</code></pre>
<p><strong>Important syntax difference:</strong></p>
<ul>
<li>Simple <code>/run {...}</code> interpolates mlld variables with <code>@var</code> syntax</li>
<li>Shell <code>/run sh (@var) {...}</code> declares parameters in parentheses, then uses <code>$var</code> syntax inside</li>
</ul>
<h3 id="for-executables" tabindex="-1">For Executables</h3>
<p>Define executables with bash or sh to handle large data:</p>
<pre class="language-mlld"><code class="language-mlld"><span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Load entire codebase
/<span class="token directive keyword">var</span> <span class="token variable variable">@contracts</span> <span class="token assignment-operator operator">=</span> <span class="token comparison-operator operator">&lt;</span>**/*<span class="token field-access property">.sol</span><span class="token comparison-operator operator">></span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Process <span class="token operator">with</span> shell executable - parameter becomes shell variable
/<span class="token directive keyword">exe</span> <span class="token variable variable">@analyze</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token assignment-operator operator">=</span> sh <span class="token punctuation">{</span>
  echo <span class="token string-interpolated"><span class="token punctuation">"</span>$code<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> solidity-analyzer
<span class="token punctuation">}</span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Pass the mlld variable <span class="token directive keyword">when</span> calling
/<span class="token directive keyword">show</span> <span class="token variable variable">@analyze</span><span class="token punctuation">(</span><span class="token variable variable">@contracts</span><span class="token punctuation">)</span>
</code></pre>
<p>The key: shell mode receives mlld variables as parameters (declared in parentheses), then accesses them as shell variables with <code>$</code> inside the code block.</p>
<h3 id="working-with-external-tools" tabindex="-1">Working with External Tools</h3>
<p>Pipe data to tools instead of passing as arguments:</p>
<pre class="language-mlld"><code class="language-mlld"><span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Good pattern <span class="token directive keyword">for</span> large data
/<span class="token directive keyword">exe</span> <span class="token variable variable">@process</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token assignment-operator operator">=</span> sh <span class="token punctuation">{</span>
  echo <span class="token string-interpolated"><span class="token punctuation">"</span>$content<span class="token punctuation">"</span></span> <span class="token pipe-operator operator">|</span> jq <span class="token string-literal">'.items[]'</span>
<span class="token punctuation">}</span>

<span class="token comparison-operator operator">></span><span class="token comparison-operator operator">></span> Load many files
/<span class="token directive keyword">var</span> <span class="token variable variable">@configs</span> <span class="token assignment-operator operator">=</span> <span class="token comparison-operator operator">&lt;</span>**/*<span class="token field-access property">.json</span><span class="token comparison-operator operator">></span>
/<span class="token directive keyword">show</span> <span class="token variable variable">@process</span><span class="token punctuation">(</span><span class="token variable variable">@configs</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="how-it-works" tabindex="-1">How It Works</h2>
<ul>
<li>Simple <code>/run {...}</code> now auto-falls back to bash when command/env payloads are large. The script is streamed via stdin to avoid args+env limits.</li>
<li>Shell mode <code>/run sh {...}</code> injects large variables directly into the shell script instead of the environment (via heredoc), bypassing Node's limit.</li>
<li>Your variables work the same - just use <code>$varname</code> in shell mode.</li>
</ul>
<p>To disable auto-fallback (for debugging/policy), set <code>MLLD_DISABLE_SH=1</code>. In that mode, <code>/run</code> is strict and will error with guidance when payloads are too large.</p>
<h2 id="when-you'll-hit-this" tabindex="-1">When You'll Hit This</h2>
<p>Common scenarios that exceed 128KB:</p>
<ul>
<li>Loading all source files: <code>&lt;**/*.js&gt;</code></li>
<li>Processing large JSON files</li>
<li>Working with documentation: <code>&lt;docs/**/*.md&gt;</code></li>
<li>Analyzing entire codebases</li>
</ul>
<h2 id="error-messages" tabindex="-1">Error Messages</h2>
<p>With the default auto-fallback, you should rarely see size-related errors. If <code>MLLD_DISABLE_SH=1</code> is set, <code>/run</code> will be strict and show helpful guidance when payloads are too large.</p>

  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButton = document.querySelector('.docs-sidebar-toggle');
    const sidebar = document.getElementById('docs-sidebar');
    const overlay = document.getElementById('docs-overlay');
    
    // Function to toggle the sidebar
    function toggleSidebar() {
      const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true';
      toggleButton.setAttribute('aria-expanded', !isExpanded);
      sidebar.classList.toggle('open');
      
      // Toggle overlay
      overlay.classList.toggle('active');
      
      // Lock/unlock body scroll when sidebar is open on mobile
      if (window.innerWidth <= 950) {
        document.body.classList.toggle('sidebar-open', !isExpanded);
      }
    }
    
    // Add click event for toggle button
    toggleButton.addEventListener('click', toggleSidebar);
    
    // Add click event for overlay to close sidebar
    overlay.addEventListener('click', function() {
      if (sidebar.classList.contains('open')) {
        toggleSidebar();
      }
    });
    
    // Close sidebar when clicking on a link (mobile only)
    sidebar.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 950 && sidebar.classList.contains('open')) {
          toggleSidebar();
        }
      });
    });
    
    // Close sidebar when clicking outside of it (mobile only) - now handled by overlay
    document.addEventListener('click', function(event) {
      if (window.innerWidth <= 950 && 
          sidebar.classList.contains('open') && 
          !sidebar.contains(event.target) && 
          !toggleButton.contains(event.target) &&
          !overlay.contains(event.target)) {
        toggleSidebar();
      }
    });
  });
</script>

    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 mlld - <a href="https://github.com/mlld-lang/mlld">GitHub</a></p>
    </div>
  </footer>
</body>
</html>