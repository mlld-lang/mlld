>> Gate â€” checks output quality before finalizing

import { @claudePoll } from @mlld/claude-poll

exe @checkPrompt(task, agentOutput) = template "./prompts/gate/check.att"

>> Evaluate whether agent output meets quality standards
exe @checkOutput(task, agentOutput) = [
  let @outPath = `@root/tmp/gate-@task.id\.json`
  let @prompt = @checkPrompt(@task, @output)
  let @fullPrompt = `@prompt

IMPORTANT: Write your JSON response to @outPath using the Write tool.`

  @claudePoll(@fullPrompt, "haiku", "@root", "Read,Write", @outPath)
  let @result = <@outPath>? | @parse

  >> Default to pass if gate itself fails
  when !@result => [ => { pass: true, feedback: null } ]
  => @result
]

export { @checkOutput }
