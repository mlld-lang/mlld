## QA Testing: @topic

You are testing mlld's `@topic` feature through black-box testing.

## Constraints

Use ONLY information available via mlld commands:
- `mlld howto @topic`
- `mlld howto grep <pattern>`
- `mlld howto core-modules`

Do NOT:
- Investigate the mlld codebase (no reading source files)
- Search the Internet
- Read tests/cases/ or other implementation details

Your fresh perspective is valuable - we want to capture genuine first-impression friction.

## First: Check Prior Work

Before creating new experiments, check if `@outputDir/@topic/` already exists:

```bash
ls -la @outputDir/@topic/
```

### If directory exists with experiments:

1. **Review existing results.json files** in each experiment directory
2. **Assess the state:**
   - If L-level experiments are failing with `major` issues → Run through the "Before Declaring Anything Blocked" checklist, then STOP. Document what you tried in a `blocked.md` file and exit.
   - If all experiments pass → Consider adding higher complexity (M→H) or more edge cases
   - If coverage seems complete → Create `complete.md` explaining why no more tests needed, then exit.
3. **Add new experiments** with the next available number (e.g., if 01-03 exist, start at 04)

### If directory doesn't exist:

1. Start with L-level experiments (write files directly — directories are auto-created)

## Your Task

1. Run `mlld howto @topic` to understand the feature
2. Check for prior work (see above)
3. Create NEW experiments that add value (don't redo existing work)
4. Write `results.json` in each new experiment directory

## Directory Structure

```
@outputDir/@topic/
├── mlld-config.json         # Created by `mlld init`
├── 01-L-experiment-name/
│   ├── experiment.mld       # REQUIRED: Your test script (preserved for debugging/reuse)
│   ├── results.json         # Your findings
│   └── [other files]        # Any support files needed by experiment.mld
├── 02-M-experiment-name/
│   └── ...
├── 03-H-experiment-name/
│   └── ...
├── blocked.md               # If L-level fails, explain and stop
└── complete.md              # If no more tests add value
```

## IMPORTANT: Creating Directories and Files

**Do NOT use `mkdir` to create experiment directories.** Instead, use the Write tool to create files directly — it automatically creates parent directories. For example, to create `01-L-basic-usage/experiment.mld`, just write the file directly to that path. The directory will be created for you.

**Always save `experiment.mld`** in the experiment directory BEFORE running it. This file:
- Contains the exact mlld code you tested
- Enables debugging failed experiments later
- Can be converted to regression tests
- Lets future agents refine rather than redo work

Example workflow:
1. Write your test code to `@outputDir/@topic/04-M-edge-case/experiment.mld` (directory auto-created)
2. Run `mlld @outputDir/@topic/04-M-edge-case/experiment.mld`
3. Record results in `results.json`

## Issue Categories

| Category | Description |
|----------|-------------|
| `broken-promise` | Docs say X, behavior is Y |
| `unclear-error` | Error message doesn't help diagnose the problem |
| `unclear-docs` | Missing information or confusing explanation |
| `friction` | Works but feels wrong or unexpected |

## Severity Levels

| Severity | Description |
|----------|-------------|
| `major` | Significant workaround required, or no workaround found after 3+ attempts |
| `minor` | Slight friction, easy workaround |
| `enhancement` | Not a bug, improvement idea |

**Note:** There is no `blocker` severity in Phase 1. Use `major` for the most severe issues. Phase 2 (self-review) may upgrade confirmed issues to `blocker` after verifying them against test cases and source code. In Phase 1, you don't have enough information to confidently distinguish "genuinely impossible" from "I haven't found the right approach yet."

## Results Schema

Each experiment MUST produce a `results.json`:

```json
{
  "experiment": "01-L-basic-usage",
  "topic": "@topic",
  "status": "pass|fail|partial",
  "summary": "One-line description of outcome",
  "what_works": ["List of things that worked correctly (even in failed experiments)"],
  "issues": [
    {
      "category": "broken-promise|unclear-error|unclear-docs|friction",
      "severity": "major|minor|enhancement",
      "title": "Brief issue description",
      "input": "What you tried (code or command)",
      "expected": "What should have happened",
      "actual": "What actually happened",
      "workaround": "How to work around this issue (if known)",
      "recommendation": "Suggested fix",
      "related_experiments": ["Other experiment names with same/related issue"]
    }
  ],
  "context": {
    "purpose": "Why this experiment was created",
    "builds_on": "Previous experiment this extends (if any)",
    "blocks": "What this issue prevents testing (if blocker)"
  }
}
```

**Field notes:**
- `what_works`: Capture positive findings even when status is fail/partial
- `workaround`: Help users work around issues until fixed
- `related_experiments`: Link issues that share root causes
- `context.blocks`: For major issues, explain what M/H tests this prevents

## Complexity Levels

- **L** (Low): Single feature, straightforward usage from docs
- **M** (Medium): Feature combinations, realistic workflow
- **H** (High): Edge cases, stress testing, complex integration

## For LLM Testing

If testing LLM-related features, use `@@mlld/claude` with haiku:

```mlld
import { @@haiku } from @@mlld/claude
var @@response = @@haiku("Test prompt")
```

## Success Criteria

Your results.json is valid if:
1. All required fields are present (`experiment`, `topic`, `status`, `summary`, `issues`)
2. `status` is one of: pass, fail, partial
3. `issues` array exists (can be empty for pass)
4. Each issue has valid category and severity enums (severity: major, minor, or enhancement)

**Encouraged fields:**
- `what_works`: Always note positive findings, even in failed experiments
- `workaround`: If you found a way around an issue, document it
- `related_experiments`: Link issues that share root causes across experiments
- `context`: Explain why this experiment exists and what it blocks

These fields make results more actionable for fixing issues and help future agents understand the testing state.

## Before Declaring Anything Blocked

Before writing `blocked.md` or classifying any issue as `major`, you MUST:

1. **Check the intro docs**: Run `mlld howto intro` to understand fundamentals (file formats, `show` directive, basic syntax)
2. **Search broadly**: Run `mlld howto grep <keyword>` for relevant terms - the answer may be in a related topic
3. **Try at least 3 different approaches**: If your first attempt fails, try alternative syntax, different file formats (.mld vs .mld.md), or different directives before concluding something is broken
4. **Check related topics**: Run `mlld howto` to see the full topic list, then check any topics that sound related

If you skip these steps and jump to "this is broken," you will almost certainly be wrong. Most features work - the challenge is finding the right syntax and the right docs.

## Exit Conditions

You should EXIT EARLY (without creating new experiments) if:

1. **Stuck**: L-level experiments have `major` issues AND you have exhausted the "Before Declaring Anything Blocked" checklist above. Create `blocked.md` explaining what you tried (including the 3+ approaches) and stop.
2. **Complete**: Sufficient coverage exists (L, M, H with good variety). Create `complete.md` and stop.
3. **Diminishing returns**: Adding more tests won't reveal new information.

When exiting early, briefly explain your reasoning.

## If You Get Blocked by Permissions

If you attempt a tool and it is denied (permission error, not in allowedTools), do NOT retry repeatedly or wait. Instead:

1. **Write a `blocked.json` file** in the topic directory:
   ```json
   // Write to: @outputDir/@topic/blocked.json
   {
     "blocked": "Brief description of what you cannot do",
     "attempted_tools": ["Bash(example command)"],
     "partial_work": "Description of what you accomplished before getting blocked"
   }
   ```

2. **Continue with any remaining work you CAN do** (e.g., finish other experiments that don't need the blocked tool).

3. **Exit normally** after writing blocked.json and completing whatever work is possible.

This lets the orchestrator detect the block and continue with other topics.

## Begin

1. Check if `@outputDir/@topic/` exists
2. If exists: review prior results, decide whether to add more or exit
3. If not: run `mlld howto @topic` and `mlld howto intro`, then create initial experiments
